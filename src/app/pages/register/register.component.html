<section class="register-page">
  <h1>Crear cuenta</h1>

  <form [formGroup]="registerForm" (ngSubmit)="submit()" novalidate>
    <div class="form-field">
      <label for="username">Nombre</label>
      <input id="username" type="text" formControlName="username" placeholder="Introduce tu nombre de usuario" />
      <div class="error" *ngIf="username?.invalid && (username?.touched || submitted())">
        <span *ngIf="username?.errors?.['required']">Requerido</span>
        <span *ngIf="username?.errors?.['minlength']">Mínimo 2 caracteres</span>
      </div>
    </div>

    <div class="form-field">
      <label for="email">Correo electrónico</label>
      <input id="email" type="email" formControlName="email" placeholder="Introduce tu correo electrónico" />
      <div class="error" *ngIf="email?.invalid && (email?.touched || submitted())">
        <span *ngIf="email?.errors?.['required']">Requerido</span>
        <span *ngIf="email?.errors?.['email']">Email inválido</span>
      </div>
    </div>

    <div class="form-field">
      <label for="password">Contraseña</label>
      <input id="password" type="password" formControlName="password" placeholder="Introduce tu contraseña" />
      <div class="error" *ngIf="password?.invalid && (password?.touched || submitted())">
        <span *ngIf="password?.errors?.['required']">Requerido</span>
        <span *ngIf="password?.errors?.['minlength']">Mínimo 8 caracteres</span>
      </div>
    </div>

    <div class="form-field">
      <label for="confirm">Confirmar contraseña</label>
      <input
        id="confirm"
        type="password"
        formControlName="confirm"
        placeholder="Repite tu contraseña"
        [class.mismatch]="passwordMismatch"
        [attr.aria-invalid]="passwordMismatch ? true : null"
        aria-describedby="password-mismatch"
      />
      <div
        id="password-mismatch"
        class="error"
        aria-live="polite"
        *ngIf="(confirm?.touched || submitted()) && (confirm?.invalid || passwordMismatch)"
      >
        <span *ngIf="confirm?.errors?.['required']">Requerido</span>
        <span *ngIf="passwordMismatch">Las contraseñas no coinciden</span>
      </div>
    </div>

    <div class="form-field">
      <label for="role">Rol</label>
      <select id="role" formControlName="role">
        <option value="artist">Artista</option>
        <option value="listener">Oyente</option>
      </select>
      <div class="error" *ngIf="role?.invalid && (role?.touched || submitted())">
        <span>Requerido</span>
      </div>
    </div>

    <p class="api-error" *ngIf="apiError()">{{ apiError() }}</p>

    <button type="submit" [disabled]="submitting() || passwordMismatch">
      {{ submitting() ? 'Registrando…' : 'Registrarme' }}
    </button>
  </form>
</section>
