<section class="albums-page">
  <!-- Barra de b√∫squeda -->
  <div class="search-bar" role="search">
    <input 
      type="search" 
      placeholder="Buscar √°lbumes" 
      (keyup.enter)="searchAlbums()" 
      [(ngModel)]="searchQuery" 
      aria-label="Buscar √°lbumes" 
    />
    <button (click)="searchAlbums()" type="button" aria-label="Bot√≥n de buscar">buscar</button>
  </div>

  <!-- Error banner cuando falla el backend (solo en modo debug) -->
  <div *ngIf="showDebugInfo && errorMsg" class="error-banner" role="alert">
    {{ errorMsg }}
  </div>

  <header class="albums-page__header">
    <h1>√Ålbumes Destacados</h1>
    
      <!-- Indicador de fuente de datos (solo en modo debug) -->
      <div *ngIf="showDebugInfo" class="data-source-indicator" [ngClass]="dataSource">
        <span *ngIf="dataSource === 'backend'" class="badge badge-backend">
          üåê Conectado al Backend
        </span>
        <span *ngIf="dataSource === 'mock'" class="badge badge-mock">
          üì¶ Datos de Prueba (Mock)
        </span>
      </div>
    
    <p>
      Descubre √°lbumes de artistas independientes. Nuevas propuestas y cl√°sicos
      de la comunidad UnderSounds.
    </p>

    <!-- Filtros avanzados -->
    <div class="filters-container">
      <div class="filters-row">
        <!-- G√©nero -->
        <div class="filter-group">
          <label for="genre-select">G√©nero:</label>
          <select 
            id="genre-select" 
            [(ngModel)]="selectedGenre" 
            (change)="applyFilters()"
            class="filter-select"
          >
            <option value="">Todos</option>
            <option *ngFor="let genre of availableGenres" [value]="genre">{{ genre }}</option>
          </select>
        </div>

        <!-- Tag -->
        <div class="filter-group">
          <label for="tag-select">Etiqueta:</label>
          <select 
            id="tag-select" 
            [(ngModel)]="selectedTag" 
            (change)="applyFilters()"
            class="filter-select"
          >
            <option value="">Todas</option>
            <option *ngFor="let tag of availableTags" [value]="tag">{{ tag }}</option>
          </select>
        </div>

        <!-- Estado -->
        <div class="filter-group">
          <label for="release-state-select">Estado:</label>
          <select 
            id="release-state-select" 
            [(ngModel)]="selectedReleaseState" 
            (change)="applyFilters()"
            class="filter-select"
          >
            <option value="">Todos</option>
            <option *ngFor="let state of availableReleaseStates" [value]="state">{{ state }}</option>
          </select>
        </div>
      </div>

      <!-- Bot√≥n limpiar filtros -->
      <div class="filters-actions">
        <button (click)="clearFilters()" class="btn-clear-filters">
          Limpiar filtros
        </button>
      </div>
    </div>
  </header>

  <!-- Indicador de carga -->
  <div *ngIf="isLoading" class="loading-indicator">
    Cargando √°lbumes...
  </div>

  <!-- Grid de √°lbumes -->
  <div class="album-grid" *ngIf="!isLoading">
    <article class="album-card" *ngFor="let album of albums" (click)="navigateToAlbumDetail(album.id)">
      <figure class="album-card__cover">
        <img [src]="album.cover" [alt]="'Portada de ' + album.title" loading="lazy" />
      </figure>

      <div class="album-card__body">
        <h3>{{ album.title }}</h3>
        <p class="album-card__description">{{ album.description }}</p>
        <div class="album-card__metadata" *ngIf="album.genres || album.releaseState">
          <span *ngFor="let genre of album.genres" class="metadata-tag">{{ genre }}</span>
          <span class="metadata-tag state" [ngClass]="'state-' + album.releaseState">{{ album.releaseState }}</span>
        </div>
      </div>

      <footer class="album-card__meta">
        <span class="album-card__date">{{ album.releaseDate }}</span>
        <span class="album-card__price">{{ album.price }} {{ album.currency }}</span>
      </footer>
      <button class="fav-button" (click)="toggleFavorite(album, $event)">
        <svg class="heart-icon" viewBox="0 0 24 24">
          <path
            [attr.fill]="isFavorite(album.id) ? '#e63946' : 'none'"
            stroke="#e63946"
            stroke-width="2"
            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
              2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09
              C13.09 3.81 14.76 3 16.5 3
              19.58 3 22 5.42 22 8.5
              c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
      </button>
    </article>
  </div>

  <!-- Mensaje cuando no hay resultados -->
  <div *ngIf="!isLoading && albums.length === 0" class="no-results">
    <p>No se encontraron √°lbumes con los filtros seleccionados.</p>
    <button (click)="clearFilters()" class="btn-clear-filters">Limpiar filtros</button>
  </div>

  <!-- Paginaci√≥n (solo cuando se usa backend) -->
  <div *ngIf="useBackend && !isLoading" class="pagination">
    <button 
      (click)="prevPage()" 
      [disabled]="currentPage === 1"
      class="pagination-btn"
    >
      ‚Üê Anterior
    </button>
    <span class="pagination-info">P√°gina {{ currentPage }} de {{ totalPages }}</span>
    <button 
      (click)="nextPage()" 
      [disabled]="currentPage === totalPages"
      class="pagination-btn"
    >
      Siguiente ‚Üí
    </button>
  </div>
</section>
